<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Widget: editablefield</title>

  <!-- All widgets require jquery AND jquery UI -->
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

  <script src="../formula.js"></script>
  <script src="../library/referencetypes/Element.js"></script>

  <!-- The widget that we are demonstrating here -->
  <script src="../library/widgets/editablefield.js"></script>

  <script>


  Formula.addFunction('SUM', function() {
    var result=0;
    for (var i=0; i<arguments.length; i++) {
      result += parseFloat(arguments[i]);
    }
    return result;
  });

  function dollarFormatter(text) {
    return '$' + text;
  }
  // Deformat currency
  function dollarDeformatter(text) {
    // In this case, we want the user to be allowed
    // to enter the currency with or without the "$" prepended
    if (text[0] == '$') {
      return text.substr(1);
    }
    return text;
  }

  $(function() { 

    $( "#ex1" ).editablefield( {
      formula: '3',
      formatter: dollarFormatter,
      deformatter: dollarDeformatter,
    });
    $( "#ex2" ).editablefield( {
      formula: '3',
      formatter: dollarFormatter,
      deformatter: dollarDeformatter,
      manualValue: 4,
    });

    Formula.addFunction('FIELD_VALUE', function(elm) {
//return Math.random(18)
      return $( elm ).editablefield('getValue');
    });
    $( "#ex3" ).editablefield( {
//      formula: 'SUM(#ex1,FIELD_VALUE(#ex2.element))',
      formula: 'SUM(FIELD_VALUE(#ex1.element),FIELD_VALUE(#ex2.element))',
      formatter: dollarFormatter,
      deformatter: dollarDeformatter,
    });

    $( "#ex5" ).editablefield( {
//      formula: 'SUM(#ex1,FIELD_VALUE(#ex2.element))',
      formula: 'SUM(FIELD_VALUE(#ex3.element),#ex4)',
      formatter: dollarFormatter,
      editable: false
    });


  });


  </script>
<style>
  body {max-width: 1200px; padding:2% 5%}
  input {width: 200px; margin-right: 10px;}
  pre {font-family:monospace; padding: 10px; border: 1px solid #666; background-color: #eee}
  input[readonly] {background-color: #eee}
  td {vertical-align: top}
  td pre {margin-top: 0px}

  input {
    background-color: white;
    color: #666;
  }

  .editable-field {
    background-color: #d6e7f3; 
    color: #000;
  }
  .editable-field.manually-edited {
    background-color: white; 
  }


</style>

</head>
<body>
<h3>Widget: EditableField</h3>
<p>
The editabale field widget can do the same as the calculatedfield widget. But it also allows users to manually override the calculated value. It even works with a formatter, but you will also have to provide a 'deformater', to allow users to enter values in the same format as your formatter uses.
</p>

<p>Initially calculated</p>
<input id="ex1"></input><br>

<p>Initially manually edited</p>
<input id="ex2"></input><br>

<p>The user can revert a field to calculculated field by clearing the value</p>

<!--Sum: <input id="ex3" data-formula="SUM(FIELD_VALUE(#ex1.element),FIELD_VALUE(#ex2.element))"></input><br>-->
Sum (editable): <input id="ex3"></input><br>

Extra: <input id="ex4" value="1"></input><br>

Total (not editable): <input id="ex5"></input><br>

</body>
</html>
